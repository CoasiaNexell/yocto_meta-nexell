From 69627d3e791d2b21d941d74acd1b0eee2decfe72 Mon Sep 17 00:00:00 2001
From: choonghyun-Jeon <suker@nexell.co.kr>
Date: Tue, 27 Sep 2016 19:03:13 +0900
Subject: [PATCH] bootcmd add for navi yocto

---
 include/configs/s5p4418_navi_ref.h | 88 ++++++++++++++++++++++++++++++++++++--
 1 file changed, 85 insertions(+), 3 deletions(-)

diff --git a/include/configs/s5p4418_navi_ref.h b/include/configs/s5p4418_navi_ref.h
index 10f5748..50e21ad 100644
--- a/include/configs/s5p4418_navi_ref.h
+++ b/include/configs/s5p4418_navi_ref.h
@@ -135,6 +135,8 @@
 #define	CONFIG_CMDLINE_TAG			/* use bootargs commandline */
 #undef	CONFIG_BOOTM_NETBSD
 #undef	CONFIG_BOOTM_RTEMS
+#define CONFIG_INITRD_TAG
+#define CONFIG_CMD_BOOTZ
 
 /*-----------------------------------------------------------------------
  * serial console configuration
@@ -204,7 +206,7 @@
 #define CONFIG_SYS_MMC_ENV_DEV		0
 #define	CONFIG_ENV_OFFSET		(CONFIG_FIP_OFFSET +\
 					 CONFIG_FIP_SIZE)
-#define CONFIG_ENV_SIZE			(4*1024)	/* env size */
+#define CONFIG_ENV_SIZE			(16*1024)	/* env size */
 #endif
 
 #if defined(CONFIG_MMC)
@@ -276,7 +278,87 @@
 /*-----------------------------------------------------------------------
  * ENV
  */
-#define CONFIG_EXTRA_ENV_SETTINGS	\
-			"fdt_high=0xffffffff"
+/*-----------------------------------------------------------------------
+ * BOOTCOMMAND
+ */
+#define CONFIG_DEFAULT_CONSOLE		"console=ttyAMA3,115200n8\0"
+
+#define CONFIG_ROOT_DEV		0
+#define CONFIG_BOOT_PART	1
+#define CONFIG_MODULE_PART	2
+#define CONFIG_ROOT_PART	3
+
+#define CONFIG_EXTRA_ENV_SETTINGS					\
+	"fdt_high=0xffffffff\0"						\
+	"kerneladdr=0x40080000\0"					\
+	"kernel_file=zImage\0"						\
+	"ramdiskaddr=0x49000000\0"					\
+	"ramdisk_file=uInitrd\0"					\
+	"fdtaddr=0x4a000000\0"						\
+	"load_fdt="							\
+		"if test -z \"$fdtfile\"; then "                        \
+		"loop=$board_rev; "					\
+		"number=$board_rev: "					\
+		"success=0; "						\
+		"until test $loop -eq 0 || test $success -ne 0; do "	\
+			"if test $loop -lt 10; then "			\
+				"number=0$loop; "			\
+			"else number=$loop; "				\
+			"fi; "						\
+			"ext4load mmc $rootdev:$bootpart $fdtaddr s5p4418-navi_ref-rev00.dtb && setexpr success 1; " \
+			"setexpr loop $loop - 1; "			\
+			"done; "					\
+		"if test $success -eq 0; then "				\
+			"ext4load mmc $rootdev:$bootpart $fdtaddr s5p4418-navi_ref-rev00.dtb;"	\
+		"fi; "							\
+		"else ext4load mmc $rootdev:$bootpart $fdtaddr $fdtfile; "      \
+		"fi; \0"						\
+	"console=" CONFIG_DEFAULT_CONSOLE				\
+	"consoleon=setenv console=" CONFIG_DEFAULT_CONSOLE		\
+		"; saveenv; reset\0"					\
+	"consoleoff=setenv console=ram; saveenv; reset\0"		\
+	"rootdev=" __stringify(CONFIG_ROOT_DEV) "\0"			\
+	"rootpart=" __stringify(CONFIG_ROOT_PART) "\0"			\
+	"bootpart=" __stringify(CONFIG_BOOT_PART) "\0"			\
+	"root_rw=rw\0"							\
+	"opts=loglevel=4\0"						\
+	"rootfs_type=ext4\0"						\
+	"lcd1_0=s6e8fa0\0"						\
+	"lcd2_0=gst7d0038\0"						\
+	"lcd_panel=s6e8fa0\0"						\
+	"sdrecovery=sd_recovery mmc 1:3 48000000 partmap_emmc.txt\0"	\
+	"factory_load=factory_info load mmc 0 "				\
+		__stringify(CONFIG_FACTORY_INFO_START) " "		\
+		__stringify(CONFIG_FACTORY_INFO_SIZE) "\0"		\
+	"factory_save=factory_info save mmc 0 "				\
+		__stringify(CONFIG_FACTORY_INFO_START) " "		\
+		__stringify(CONFIG_FACTORY_INFO_SIZE) "\0"		\
+	"factory_set_ethaddr=run factory_load; gen_eth_addr ;"		\
+		"factory_info write ethaddr $ethaddr;"			\
+		"run factory_save\0"					\
+	"load_args=run factory_load; setenv bootargs ${console} "	\
+		"root=/dev/mmcblk${rootdev}p${rootpart} ${root_rw} "	\
+		"rootfstype=${rootfs_type} ${opts} ${recoverymode} "	\
+		"drm_panel=$lcd_panel\0"				\
+	"load_kernel=ext4load mmc ${rootdev}:${bootpart} $kerneladdr $kernel_file\0" \
+	"load_initrd=ext4load mmc ${rootdev}:${bootpart} $ramdiskaddr $ramdisk_file\0" \
+	"boot_cmd_initrd="						\
+		"run load_fdt; run load_kernel; run load_initrd;"	\
+		"bootz $kerneladdr $ramdiskaddr $fdtaddr\0"		\
+	"boot_cmd_mmcboot="						\
+                "ext4load mmc $rootdev:$bootpart $fdtaddr s5p4418-navi_ref-rev00.dtb;" \
+		"run load_kernel;"	   		                \
+		"bootz $kerneladdr - $fdtaddr\0"			\
+        "bootargs=console=ttyAMA3,115200n8 root=/dev/mmcblk0p3 rw rootfstype=ext4 loglevel=4 rootwait quiet printk.time=1\0" \
+	"ramfsboot=run load_args; run boot_cmd_initrd\0"		\
+	"mmcboot=run boot_cmd_mmcboot\0"			        \
+	"recovery_cmd=run sdrecovery; setenv recoverymode recovery\0"	\
+	"recoveryboot=run recovery_cmd; run ramfsboot\0"		\
+	"hwtestboot=setenv rootdev 1;"					\
+		"setenv opts rootfstype=ext4 rootwait loglevel=7;"	\
+		"setenv fdtfile s5p4418-navi_ref-explorer.dtb;"		\
+		"run mmcboot\0"						\
+	"hwtest_recoveryboot=run recovery_cmd; run hwtestboot\0"        \
+	"bootcmd=run mmcboot\0"
 
 #endif /* __CONFIG_H__ */
-- 
1.9.1

