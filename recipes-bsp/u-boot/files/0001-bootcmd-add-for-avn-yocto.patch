From 629180a9b536b3151a9077fcbb42db699e7746b8 Mon Sep 17 00:00:00 2001
From: choonghyun-Jeon <suker@nexell.co.kr>
Date: Wed, 22 Jun 2016 17:18:59 +0900
Subject: [PATCH] bootcmd add for avn yocto

---
 include/configs/s5p4418_avn_ref.h | 74 ++++++++++++++++++++++++++++++++++++++-
 1 file changed, 73 insertions(+), 1 deletion(-)

diff --git a/include/configs/s5p4418_avn_ref.h b/include/configs/s5p4418_avn_ref.h
index c34dd1e..add3e5d 100644
--- a/include/configs/s5p4418_avn_ref.h
+++ b/include/configs/s5p4418_avn_ref.h
@@ -273,10 +273,82 @@
 #define CONFIG_FIT_BEST_MATCH
 #define CONFIG_OF_LIBFDT
 
+#define CONFIG_DEFAULT_CONSOLE          "console=ttyAMA3,115200n8\0"
+
 /*-----------------------------------------------------------------------
  * ENV
  */
+#define CONFIG_ROOT_DEV         0
+#define CONFIG_BOOT_PART        1
+#define CONFIG_MODULE_PART      2
+#define CONFIG_ROOT_PART        3
+
 #define CONFIG_EXTRA_ENV_SETTINGS	\
-			"fdt_high=0xffffffff"
+         "fdt_high=0xffffffff\0"                                         \
+         "initrd_high=0xffffffff\0"                                      \
+         "kerneladdr=0x48000000\0"                                       \
+         "kernel_file=uImage\0"                                          \
+         "ramdiskaddr=0x49000000\0"                                      \
+         "ramdisk_file=ramdisk.gz\0"                                     \
+         "fdtaddr=0x4a000000\0"                                          \
+         "load_fdt="                                                     \
+                 "loop=$board_rev; "                                     \
+                 "number=$board_rev: "                                   \
+                 "success=0; "                                           \
+                 "until test $loop -eq 0 || test $success -ne 0; do "    \
+                         "if test $loop -lt 10; then "                   \
+                                 "number=0$loop; "                       \
+                         "else number=$loop; "                           \
+                         "fi; "                                          \
+                         "ext4load mmc $rootdev:$bootpart $fdtaddr s5p4418-avn_ref.dtb && setexpr success 1; " \
+                         "setexpr loop $loop - 1; "                      \
+                         "done; "                                        \
+                 "if test $success -eq 0; then "                         \
+                         "ext4load mmc $rootdev:$bootpart $fdtaddr s5p4418-avn_ref.dtb;"   \
+                 "fi; \0"                                                \
+         "console=" CONFIG_DEFAULT_CONSOLE                               \
+         "consoleon=set console=" CONFIG_DEFAULT_CONSOLE                 \
+                 "; saveenv; reset\0"                                    \
+         "consoleoff=set console=ram; saveenv; reset\0"                  \
+         "rootdev=" __stringify(CONFIG_ROOT_DEV) "\0"                    \
+         "rootpart=" __stringify(CONFIG_ROOT_PART) "\0"                  \
+         "bootpart=" __stringify(CONFIG_BOOT_PART) "\0"                  \
+         "root_rw=rw\0"                                                  \
+         "opts=loglevel=4\0"                                             \
+         "rootfs_type=ext4\0"                                            \
+         "sdrecovery=sd_recovery mmc 1:3 48000000 partmap_emmc.txt\0"    \
+         "factory_load=factory_info load mmc 0 "                         \
+                 __stringify(CONFIG_FACTORY_INFO_START) " "              \
+                 __stringify(CONFIG_FACTORY_INFO_SIZE) "\0"              \
+         "factory_save=factory_info save mmc 0 "                         \
+                 __stringify(CONFIG_FACTORY_INFO_START) " "              \
+                 __stringify(CONFIG_FACTORY_INFO_SIZE) "\0"              \
+         "factory_set_ethaddr=run factory_load; gen_eth_addr ;"          \
+                 "factory_info write ethaddr $ethaddr;"                  \
+                 "run factory_save\0"                                    \
+         "boot_cmd_initrd="                                              \
+                 "run load_fdt;"                                         \
+                 "ext4load mmc ${rootdev}:${bootpart} $kerneladdr $kernel_file;" \
+                 "ext4load mmc ${rootdev}:${bootpart} $ramdiskaddr $ramdisk_file;" \
+                 "bootm $kerneladdr - $fdtaddr\0"                \
+         "ramfsboot=setenv bootargs ${console} "                         \
+                 "root=/dev/ram0 ${root_rw} initrd=${ramdiskaddr},16M ramdisk=16384 "    \
+                 "${opts} ${recoverymode} bd_addr=${bd_addr};"           \
+                 "run boot_cmd_initrd\0"                                 \
+         "mmcboot_yocto=setenv bootargs ${console} "                     \
+                 "root=/dev/mmcblk1p1 ${root_rw} init=/sbin/init "    \
+                 "${opts} bd_addr=${bd_addr} rootwait fb=/dev/fb0;"     \
+                 "run boot_cmd_initrd\0"                                 \
+         "mmcboot=setenv bootargs ${console} "                           \
+                 "root=/dev/mmcblk${rootdev}p${rootpart} ${root_rw} "    \
+                 "${opts} bd_addr=${bd_addr};"                           \
+                 "run boot_cmd_initrd\0"                                 \
+         "recoveryboot=run sdrecovery; setenv recoverymode recovery;"    \
+                 "run ramfsboot\0"                                       \
+         "hwtestboot=run sdrecovery; setenv rootdev 1;"                  \
+                "setenv opts rootfstype=ext4 rootwait loglevel=7;"      \
+                 "run mmcboot\0"                                         \
+         "bootcmd=run ramfsboot\0"
+
 
 #endif /* __CONFIG_H__ */
-- 
2.7.4

